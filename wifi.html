<!DOCTYPE html>
<html lang="tr">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kompresor Kontrol</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
body { background:#0e0e0e; color:white; text-align:center; font-family:Arial; }
.btn { width:80%; max-width:300px; padding:20px; margin:15px auto;
       font-size:22px; font-weight:bold; border:none; border-radius:14px;
       color:white; transition:0.15s; }
.btn-start { background:#00c853; }
.btn-stop  { background:#d50000; }
.disabled { opacity:0.35; pointer-events:none; filter:grayscale(100%); }
</style>
</head>

<body>
<h2>KompresÃ¶r Kontrol</h2>
<h2>( Made in Ersin )</h2>

<button id="btnStart" class="btn btn-start disabled">ðŸŸ¢ START</button>
<button id="btnStop"  class="btn btn-stop  disabled">ðŸ”´ STOP</button>

<script>
const btnStart = document.getElementById("btnStart");
const btnStop  = document.getElementById("btnStop");

let online = false;
let startState = 0;
let stopState  = 0;
let openState  = 0;

function updateButtons() {

  // START
  if (online && openState===0 && startState===0 && stopState===0)
    btnStart.classList.remove("disabled");
  else
    btnStart.classList.add("disabled");

  // STOP
  if (online && openState===1 && startState===0 && stopState===0)
    btnStop.classList.remove("disabled");
  else
    btnStop.classList.add("disabled");
}

const client = mqtt.connect(
  "wss://356d2463ef40488694ce4fe2d4a23976.s1.eu.hivemq.cloud:8884/mqtt",
  { username:"wersin3230", password:"We112233" }
);

client.on("connect", () => {
  online = true;
  client.subscribe("esp32/status");
  client.subscribe("esp32/start_state");
  client.subscribe("esp32/stop_state");
  client.subscribe("esp32/open_state");
});

client.on("close",   ()=>{ online=false; updateButtons(); });
client.on("offline", ()=>{ online=false; updateButtons(); });

client.on("message",(t,m)=>{
  const v = m.toString();
  if (t==="esp32/status")      online = v==="1";
  if (t==="esp32/start_state") startState = v==="1"?1:0;
  if (t==="esp32/stop_state")  stopState  = v==="1"?1:0;
  if (t==="esp32/open_state")  openState  = v==="1"?1:0;
  updateButtons();
});

btnStart.onclick = ()=> client.publish("esp32/start","1");
btnStop.onclick  = ()=> client.publish("esp32/stop","1");
</script>
</body>
</html>

















