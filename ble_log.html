<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>KOMPRESOR BLE LOG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    height: 100%;
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(to bottom right, #74ebd5, #ACB6E5);
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    width: 95%;
    max-width: 520px;
    background: rgba(0,0,0,0.15);
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    color: white;
}

h2 {
    text-align: center;
    margin-bottom: 15px;
}

.button-group {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

button {
    padding: 18px;
    font-size: 1.4em;
    border-radius: 16px;
    border: none;
    cursor: pointer;
    color: white;
}

#btnConnect { background: linear-gradient(135deg,#007bff,#00bfff); }
#btnStart   { background: linear-gradient(135deg,#28a745,#218838); }
#btnStop    { background: linear-gradient(135deg,#dc3545,#ff4c4c); }
#btnReset   { background: linear-gradient(135deg,#8e44ad,#c0392b); }
#btnToggle  { background: linear-gradient(135deg,#ff9900,#ffcc33); }

button.disabled {
    opacity: 0.5;
    pointer-events: none;
}

#logArea {
    margin-top: 20px;
    height: 220px;
    background: rgba(0,0,0,0.3);
    border-radius: 12px;
    padding: 10px;
    font-family: monospace;
    overflow-y: auto;
    font-size: 0.85em;
}
</style>
</head>

<body>
<div class="container">
    <h2>Bluetooth</h2>
    <div class="button-group">
        <button id="btnConnect">Bağlan</button>
    </div>

    <h2>Komutlar</h2>
    <div class="button-group">
        <button id="btnStart"  onclick="sendCommand('START')">START</button>
        <button id="btnStop"   onclick="sendCommand('STOP')">STOP</button>
        <button id="btnReset"  onclick="sendCommand('RESET')">RESET</button>
        <button id="btnToggle" onclick="toggleLog()">LOG TOGGLE</button>
    </div>

    <div id="logArea"></div>
</div>

<script>
let device;
let commandChar;
let logChar;

const buttons = document.querySelectorAll("button:not(#btnConnect)");
buttons.forEach(b => b.classList.add("disabled"));

const logArea = document.getElementById("logArea");

document.getElementById("btnConnect").onclick = async () => {
    try {
        device = await navigator.bluetooth.requestDevice({
            filters: [{ name: "KOMPRESOR" }],
            optionalServices: [
                "00001234-0000-1000-8000-00805f9b34fb",
                "00005678-0000-1000-8000-00805f9b34fb"
            ]
        });

        const server = await device.gatt.connect();

        // Komut servisi
        const cmdService = await server.getPrimaryService("00001234-0000-1000-8000-00805f9b34fb");
        commandChar = await cmdService.getCharacteristic("0000abcd-0000-1000-8000-00805f9b34fb");

        // Log servisi
        const logService = await server.getPrimaryService("00005678-0000-1000-8000-00805f9b34fb");
        logChar = await logService.getCharacteristic("00001234-0000-1000-8000-00805f9b34fc");

        await logChar.startNotifications();
        logChar.addEventListener("characteristicvaluechanged", e => {
            const text = new TextDecoder().decode(e.target.value);
            logArea.innerHTML += text + "<br>";
            logArea.scrollTop = logArea.scrollHeight;
        });

        buttons.forEach(b => b.classList.remove("disabled"));
        document.getElementById("btnConnect").innerText = "BAĞLI";
    }
    catch (e) {
        alert("Bluetooth bağlanamadı");
        console.error(e);
    }
};

async function sendCommand(cmd) {
    if (!commandChar) return;
    await commandChar.writeValue(new TextEncoder().encode(cmd));
}

async function toggleLog() {
    if (!logChar) return;
    await logChar.writeValue(new TextEncoder().encode("TOGGLE_LOG"));
}
</script>
</body>
</html>


