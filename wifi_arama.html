<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>KOMPRESOR WiFi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow">

<style>
body{
  background:linear-gradient(to bottom right,#74ebd5,#ACB6E5);
  font-family:Segoe UI;
  text-align:center;
  padding:20px;
}
button,input{
  width:100%;
  font-size:1.2em;
  padding:14px;
  margin:6px 0;
  border-radius:14px;
  border:none;
}
button{background:#007bff;color:#fff}
ul{list-style:none;padding:0}
li{
  background:rgba(0,0,0,.25);
  margin:6px 0;
  padding:10px;
  border-radius:12px;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>Bluetooth</h2>
<button onclick="connectBLE()">BLE Bağlan</button>

<h2>Wi-Fi</h2>
<button onclick="scanWifi()">Wi-Fi Tara</button>
<ul id="list"></ul>

<input id="ssid" placeholder="SSID">
<input id="pass" placeholder="Şifre" type="password">
<button onclick="connectWifi()">Bağlan</button>

<h3 id="status">Durum: -</h3>

<script>
let device, characteristic;

const SERVICE = "00001234-0000-1000-8000-00805f9b34fb";
const CHAR    = "0000abcd-0000-1000-8000-00805f9b34fb";

async function connectBLE(){
  try{
    device = await navigator.bluetooth.requestDevice({
      filters:[{ name:"KOMPRESOR" }],
      optionalServices:[SERVICE]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE);
    characteristic = await service.getCharacteristic(CHAR);

    status.innerText="Durum: BLE bağlı";
  }catch(e){
    status.innerText="Durum: BLE bağlanamadı";
  }
}

function scanWifi(){
  if(!characteristic) return;
  list.innerHTML="Taranıyor...";
  characteristic.writeValue(
    new TextEncoder().encode("SCAN")
  );
}

function connectWifi(){
  if(!characteristic) return;
  characteristic.writeValue(
    new TextEncoder().encode(
      `CONNECT:${ssid.value}|${pass.value}`
    )
  );
}

function onData(txt){
  if(txt==="CONNECTED"||txt==="FAILED"){
    status.innerText="Durum: "+txt;
    return;
  }

  list.innerHTML="";
  txt.split(";").forEach(x=>{
    if(!x) return;
    const [s,r]=x.split(",");
    const li=document.createElement("li");
    li.innerHTML=`<b>${s}</b><br>RSSI:${r}`;
    li.onclick=()=>ssid.value=s;
    list.appendChild(li);
  });
}

/* NOTIFY YOK → ESP32 yazarsa yine çalışır */
navigator.bluetooth?.addEventListener?.("characteristicvaluechanged",e=>{
  onData(new TextDecoder().decode(e.target.value));
});
</script>

</body>
</html>







