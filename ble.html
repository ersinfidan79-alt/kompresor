
  
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">

  <!-- INDEX ENGELLE -->
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">

  <title>ESP32 BLE WiFi Tarama</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
    }

    button {
      padding: 12px 20px;
      margin: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    #connect { background: #2196f3; color: white; }
    #scan    { background: #4caf50; color: white; }

    ul {
      list-style: none;
      padding: 0;
      max-width: 500px;
      margin: auto;
    }

    li {
      background: #222;
      margin: 6px 0;
      padding: 10px;
      border-radius: 6px;
      text-align: left;
      font-size: 14px;
    }

    .strong { color: #4caf50; }
    .medium { color: #ffc107; }
    .weak   { color: #f44336; }
  </style>
</head>

<body>

  <h2>ESP32 BLE WiFi Tarama</h2>

  <button id="connect">üîµ BLE Baƒülan</button>
  <button id="scan" disabled>üì° WiFi Tara</button>

  <ul id="list"></ul>

<script>
let device, server, service, characteristic;

// ‚ö†Ô∏è ESP32 KODUYLA AYNI OLMALI
const SERVICE_UUID = '00001234-0000-1000-8000-00805f9b34fb';
const CHAR_UUID    = '0000abcd-0000-1000-8000-00805f9b34fb';

const connectBtn = document.getElementById('connect');
const scanBtn    = document.getElementById('scan');
const list       = document.getElementById('list');

// ---------------- BLE CONNECT ----------------
connectBtn.onclick = async () => {
  try {
    device = await navigator.bluetooth.requestDevice({
      filters: [{ services: [SERVICE_UUID] }]
    });

    server = await device.gatt.connect();
    service = await server.getPrimaryService(SERVICE_UUID);
    characteristic = await service.getCharacteristic(CHAR_UUID);

    await characteristic.startNotifications();
    characteristic.addEventListener('characteristicvaluechanged', onNotify);

    scanBtn.disabled = false;
    alert("BLE baƒülandƒ±");

  } catch (e) {
    alert("BLE baƒülantƒ± hatasƒ±");
    console.error(e);
  }
};

// ---------------- WIFI SCAN ----------------
scanBtn.onclick = async () => {
  list.innerHTML = "<li>‚è≥ Tarama yapƒ±lƒ±yor...</li>";
  await characteristic.writeValue(new TextEncoder().encode("SCAN"));
};

// ---------------- NOTIFY CALLBACK ----------------
function onNotify(event) {
  const value = new TextDecoder().decode(event.target.value);
  list.innerHTML = "";

  // Format: SSID,RSSI;SSID,RSSI;
  const networks = value.split(";");

  networks.forEach(n => {
    if (!n) return;
    const parts = n.split(",");
    if (parts.length !== 2) return;

    const ssid = parts[0];
    const rssi = parseInt(parts[1]);

    let cls = "weak";
    if (rssi > -60) cls = "strong";
    else if (rssi > -75) cls = "medium";

    const li = document.createElement("li");
    li.className = cls;
    li.innerHTML = `
      <b>${ssid}</b><br>
      RSSI: ${rssi} dBm
    `;
    list.appendChild(li);
  });
}
</script>

</body>
</html>
