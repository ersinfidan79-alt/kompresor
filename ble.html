

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ESP32 WiFi Kurulum</title>
<meta name="robots" content="noindex,nofollow">
<style>
body { background:#0f172a; color:#e5e7eb; font-family:Arial; text-align:center; }
button, select, input {
  padding:10px; width:90%; margin:6px; border-radius:6px;
}
option.weak { color:#fca5a5; }
option.mid  { color:#fde68a; }
option.good { color:#86efac; }
#status { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<h2>ESP32 WiFi Kurulumu</h2>
<button onclick="connect()">ESP32â€™ye BaÄŸlan</button>

<select id="wifi" size="8"></select>
<input id="pass" type="password" placeholder="WiFi Åžifresi">
<button onclick="send()">BaÄŸlan</button>

<div id="status"></div>

<script>
let service;

const SERVICE = '12345678-1234-1234-1234-1234567890ab';
const LIST    = '12345678-1234-1234-1234-1234567890ac';
const CRED    = '12345678-1234-1234-1234-1234567890ad';
const STATUS  = '12345678-1234-1234-1234-1234567890ae';

function bars(rssi){
  if (rssi > -50) return "ðŸ“¶ðŸ“¶ðŸ“¶ðŸ“¶";
  if (rssi > -65) return "ðŸ“¶ðŸ“¶ðŸ“¶";
  if (rssi > -75) return "ðŸ“¶ðŸ“¶";
  return "ðŸ“¶";
}

function qualityClass(rssi){
  if (rssi > -60) return "good";
  if (rssi > -75) return "mid";
  return "weak";
}

async function connect(){
  const dev = await navigator.bluetooth.requestDevice({
    filters:[{name:'ESP32-S3-WIFI-SETUP'}],
    optionalServices:[SERVICE]
  });

  const server = await dev.gatt.connect();
  service = await server.getPrimaryService(SERVICE);

  const listChar = await service.getCharacteristic(LIST);
  const data = new TextDecoder().decode(await listChar.readValue());
  render(data);

  const st = await service.getCharacteristic(STATUS);
  st.startNotifications();
  st.addEventListener('characteristicvaluechanged', e=>{
    status.innerText = new TextDecoder().decode(e.target.value);
  });
}

function render(data){
  wifi.innerHTML='';
  data.split(',').forEach(row=>{
    if(!row) return;
    let [ssid, sec, rssi] = row.split('|');
    rssi = parseInt(rssi);

    let opt = document.createElement('option');
    opt.value = ssid;
    opt.className = qualityClass(rssi);
    opt.innerText = `${bars(rssi)} ${ssid} (${rssi} dBm)`;
    wifi.appendChild(opt);
  });
}

async function send(){
  const ssid = wifi.value;
  const pass = document.getElementById('pass').value;
  const char = await service.getCharacteristic(CRED);
  await char.writeValue(new TextEncoder().encode(ssid + "|" + pass));
  status.innerText = "BaÄŸlanÄ±yor...";
}
</script>

</body>
</html>
